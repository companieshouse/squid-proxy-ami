---
- name: Bring up docker containers
  hosts: localhost
  gather_facts: false
  vars:
    inventory:
      - name: squid
        image: "geerlingguy/docker-centos7-ansible"
        # In order to run this test file you will need access to the Shared Services Config bucket.
        # The same functionality can be faked if you wish to test via another S3 bucket but the files
        # must exist with the same name and path inside S3.
        # In order for Ansible to authenticate to S3 you must provide credentials, if using AWS SSO you must provide
        # Access Key and Secret Key and Session Token as provided by AWS SSO
        # Otherwise Access Key and Secret Key should be enough.
        env: 
          AWS_ACCESS_KEY_ID: 
          AWS_SECRET_ACCESS_KEY: 
          AWS_SESSION_TOKEN: 
  roles:
    - role: provision_docker
      provision_docker_inventory: "{{ inventory }}"
      provision_docker_privileged: True

- name: Setup testing pre-reqs
  hosts: squid
  roles:
    - epel
    - cloudwatch-agent
  tasks:
    - name: install git (missing on container)
      package:
        name: "git"
        state: latest
   
- import_playbook: ../playbook.yml
  vars: 
    selinux_ports: false